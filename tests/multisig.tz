parameter
  (pair (pair nat (or (pair mutez (contract unit)) (or (option key_hash) (pair nat (list key)))))
        (list (option signature))) ;
storage (pair nat (pair nat (list key))) ;
code { DUP ;
       CAR ;
       DIP { CDR } ;
       SWAP ;
       DUP ;
       DIP { SWAP } ;
       DIP { DUP ;
             CAR ;
             DIP { CDR } ;
             DUP ;
             SELF ;
             ADDRESS ;
             CHAIN_ID ;
             PAIR ;
             PAIR ;
             PACK ;
             DIP { DUP ; CAR ; DIP { CDR } ; DIP { SWAP } } ;
             SWAP } ;
       DUP ;
       CAR ;
       DIP { CDR } ;
       DIP { SWAP } ;
       COMPARE ;
       EQ ;
       IF {} { UNIT ; FAILWITH } ;
       DIP { SWAP } ;
       DUP ;
       CAR ;
       DIP { CDR } ;
       DIP { PUSH nat 0 ;
             SWAP ;
             ITER { DIP { SWAP } ;
                    SWAP ;
                    IF_CONS
                      { IF_SOME
                          { SWAP ;
                            DIP { SWAP ;
                                  DIP 2 { DIP { DUP } ; SWAP } ;
                                  CHECK_SIGNATURE ;
                                  IF {} { UNIT ; FAILWITH } ;
                                  PUSH nat 1 ;
                                  ADD } }
                          { SWAP ; DROP } }
                      { UNIT ; FAILWITH } ;
                    SWAP } } ;
       COMPARE ;
       LE ;
       IF {} { UNIT ; FAILWITH } ;
       DROP ;
       DROP ;
       DIP { DUP ; CAR ; DIP { CDR } ; PUSH nat 1 ; ADD ; PAIR } ;
       NIL operation ;
       SWAP ;
       IF_LEFT
         { DUP ; CAR ; DIP { CDR } ; UNIT ; TRANSFER_TOKENS ; CONS }
         { IF_LEFT
             { SET_DELEGATE ; CONS }
             { DIP { SWAP ; CAR } ; SWAP ; PAIR ; SWAP } } ;
       PAIR }
